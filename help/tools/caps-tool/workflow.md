---
title: ' [!DNL Cloud Automation Patching Service (CAPS)] 工作流程的運作方式'
description: 瞭解 [!DNL Cloud Automation Patching Service (CAPS)] 工作流程程式，包括術語、工作流程階段和自動化修補管理作業。
hide: true
hidefromtoc: true
source-git-commit: eff8c0ae9e1d9db6b46ba7cfbb915685ab5b194d
workflow-type: tm+mt
source-wordcount: '831'
ht-degree: 0%

---

# [!DNL Cloud Automation Patching Service (CAPS)]工作流程的運作方式

本主題提供使用[!DNL CAPS (Cloud Automation Patching Service)]執行修補程式作業方式的高層級概觀。

## 術語

* **作業** - [!DNL CAPS]執行的主要動作：
   * 套用
   * 回覆
* **階段** — 工作流程的三個階段：
   * 初步檢查
   * 修補
   * 驗證
* **環境** — 套用修補程式的Adobe Commerce雲端環境。

## 作業

[!DNL CAPS]支援兩種主要&#x200B;*作業*，用於管理Adobe Commerce Cloud環境中的修補程式：

* **套用作業** — 透過安全且經過驗證的程式，將修補程式變更新增至您的程式碼基底。 將修補程式檔案置於「m2-hotfixes」資料夾中即可套用修補程式。

* **還原作業** — 從&#39;m2-hotfixes&#39;資料夾中移除修補程式檔案，以從程式碼庫中移除先前套用的修補程式。

>[!IMPORTANT]
>
>還原作業僅適用於最初透過[!DNL CAPS]套用的修補程式。 使用此服務無法還原手動或透過其他方法套用的修補程式。

## 階段

[!DNL CAPS]工作流程使用始終以此順序執行的三個&#x200B;*階段*，以確保安全可靠地套用修補程式：

* **初步檢查** — 驗證修補程式相容性和環境整備。
* **修補** — 在整合環境中套用或還原修補程式。
* **驗證** — 驗證修補應用程式並執行健康狀態檢查。

## 階段詳細資料

### 階段1：初步檢查

初步檢查階段會驗證修補程式是否可以安全地套用至您的環境。

**發生狀況：**

* **生產環境防護措施** （僅限生產環境）：
   * 檢查存放區是否處於維護模式
   * 驗證cron工作是否已停用
   * 若不符合條件則封鎖修補
   * 如果滿足條件則顯示確認對話方塊
* **修補程式驗證** — 驗證修補程式檔案有效且相容
* **環境評估** — 檢查環境整備與資源
* **衝突偵測** — 識別與現有程式碼的潛在衝突
* **相依性檢查** — 驗證Adobe Commerce版本相容性

### 階段2：修補

修補階段會在暫時整合環境中套用或還原修補程式以進行測試。 在此階段中，[!DNL CAPS]會建立暫時的測試環境，以安全地套用及測試修補程式，然後再對您的實際環境進行變更。

此方法可提供：

* **安全性** — 在驗證修補程式之前，不會接觸目標環境
* **測試** — 在影響生產之前，在真實環境中
* **復原功能** — 如果偵測到問題
* **隔離** — 適用於每個修補程式操作

#### 階段2a：建立整合環境

**分支建立** - [!DNL CAPS]會建立名為`{target-environment}-CAPS-{patch-id}`的暫時整合環境分支

**環境設定** — 整合環境是建立為目標環境的子項

**程式碼同步** — 整合環境會繼承目標環境的確切狀態

**資源需求** - [!DNL CAPS]會使用目標環境的程式碼基底建立暫存環境。 根據Adobe Commerce Cloud檔案，每個環境（包括整合環境）都有根據您合約的儲存空間計畫而定的個別儲存空間配置。 您合約的儲存量代表每個環境的儲存總量。 在大多數情況下，您不會遇到任何資源限制的問題。 如果您遇到任何資源限制錯誤，請檢查您的應用程式大小以及您計畫中合約的儲存空間。

#### 階段2b：整合環境中的修補應用程式

**安全測試** — 修補程式已套用至整合環境，而非直接套用至您的目標環境

**檔案管理** — 修補程式檔案置於`m2-hotfixes/`目錄中

**Git作業** — 已認可變更並推送至整合環境分支

**環境啟用** — 啟用整合環境以部署修補程式碼

#### 階段2c：合併回目標環境

**環境簽出** - [!DNL CAPS]在本機簽出您的目標環境

**合併作業** — 整合環境分支已合併至目標環境

**衝突解決** — 如果發生任何衝突，則會儘可能自動解決

**部署** — 合併的變更已部署到您的目標環境

**驗證** - [!DNL CAPS]會驗證合併是否成功，以及環境是否同步

**環境清理** — 刪除暫時整合環境以釋放資源

## 整合環境生命週期

在修補階段中，整合環境有特定的生命週期：

* **建立** — 在修補階段開始時建立
* **作用中期間** — 在修補應用程式和測試期間保持作用中
* **清理** — 在成功合併後或作業失敗時自動刪除

### 階段3：驗證

驗證階段可確保修補的應用程式正常運作並執行健康狀態檢查。

**發生狀況：**

* **應用程式健康情況檢查** — 驗證應用程式是否啟動並正確執行
* **清理** — 移除暫存環境、更新記錄檔、通知完成

## 成功指標

**套用作業：**

* 「已成功完成工作」 — 已套用修補程式，且沒有問題
* 「已套用修補程式」 — 修補程式已存在（不需要採取任何動作）
* 修補檔案已成功置於「m2-hotfix」資料夾中
* 所有驗證檢查都通過
* 應用程式健康情況檢查成功

**還原作業：**

* 「已成功完成工作」 — 修補程式已恢復且沒有問題
* 「已還原修補程式」 — 已還原修補程式（無需動作）
* 修補檔已成功從「m2-hotfix」資料夾中移除
* 所有驗證檢查都通過
* 應用程式健康情況檢查成功

## 生產環境防護措施

[!DNL CAPS]包含生產環境的特定防護措施，以防止意外中斷，並確保修補程式預先經過安全驗證。

### 生產修補的先決條件

將修補程式套用至生產環境之前，[!DNL CAPS]會檢查兩個關鍵條件：

* **維護模式** — 存放區必須處於維護模式
* **已停用Cron工作** — 必須停用Cron工作

若不符合任一條件，修補程式應用程式就會遭到封鎖，並通知使用者。

## 相關主題

* [大寫字介紹](intro.md)
* [如何存取](access.md)
* [最佳實務](best-practices.md)
* [疑難排解](troubleshooting.md)
