---
title: ACSD-68064：在具有深層巢狀類別的環境中進行排程更新期間建立的重複專案
description: 套用ACSD-68064修補程式來修正Adobe Commerce的問題，即在巢狀類別數量很大的環境中建立排程更新，會導致重複專案並防止類別儲存。
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
source-git-commit: c7a955e6f9131255420ad0a163e457bd27cfc253
workflow-type: tm+mt
source-wordcount: '393'
ht-degree: 0%

---


# ACSD-68064：在具有深層巢狀類別的環境中進行排程更新期間建立的重複專案

ACSD-68064修補程式修正了在具有大量巢狀類別的環境中建立排程更新時，導致重複專案並阻止類別儲存的問題。 安裝[[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.72時，即可使用此修補程式。 修補程式ID為ACSD-68064。 請注意，此問題已排程在Adobe Commerce 2.4.9中修正。

## 受影響的產品和版本

**已為Adobe Commerce版本建立修補程式：**

* Adobe Commerce （所有部署方法） 2.4.7-p6

**與Adobe Commerce版本相容：**

* Adobe Commerce （所有部署方法） 2.4.7 - 2.4.7-p7

>[!NOTE]
>
>此修補程式可能適用於發行版本為[!DNL Quality Patches Tool]的其他版本。 若要檢查修補程式是否與您的Adobe Commerce版本相容，請將`magento/quality-patches`套件更新至最新版本，並在[[!DNL Quality Patches Tool]上檢查相容性：搜尋修補程式頁面](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html)。 使用修補程式ID作為搜尋關鍵字，以尋找修補程式。

## 問題

在含有大量巢狀類別的環境中建立排程更新時，會導致重複專案，進而導致錯誤和無法儲存類別。

<u>要再現的步驟</u>：

1. 安裝乾淨的執行個體。
1. 修改效能夾具檔案(small.xml)以包含：
   1. **[!UICONTROL Categories]**： *2500*
   1. **[!UICONTROL Products]**： *250,000*
1. 使用命令產生資料：

   ```
   bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
   ```

1. 建立產品和類別後，請執行以下查詢，確保所有類別都設定為錨點：

   ```
   UPDATE catalog_category_entity_int set value = 1 where attribute_id = (select attribute_id from eav_attribute where attribute_code = 'is_anchor'); 
   ```

1. 重新索引資料。
1. 登入「管理員」面板，並瀏覽至「**[!UICONTROL Catalog]** > **[!UICONTROL Categories]**」。
1. 將&#x200B;**類別2**&#x200B;移動到&#x200B;**類別1**&#x200B;下，以建立更巢狀的結構。
1. 移至深度巢狀類別，例如&#x200B;**類別2.1.1**。
1. 建立&#x200B;**[!UICONTROL Scheduled Update]**。
1. 按一下&#x200B;**[!UICONTROL Save]**。

<u>預期結果</u>：

類別已成功儲存。

<u>實際結果</u>：

發生錯誤，類別無法儲存。 `var/log/exception.log`包含類似以下的錯誤：

```
Exception #0 (Magento\Framework\DB\Adapter\DuplicateException): SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '229-255' for key 'temp_category_descendants_619aaaaaaaaaa.PRIMARY', query was: INSERT INTO `temp_category_descendants_619aaaaaaaaaa` (`category_id`, `descendant_id`) SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id` FROM `catalog_category_entity` AS `ce`
 INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%') OR ce2.entity_id = ce.entity_id AND (ce2.created_in <= '1750287600' AND ce2.updated_in > '1750287600') WHERE ((ce.entity_id IN (4, 6, 7, 8, 10, 24, 25, 27, 30, 33, 34, 35, 36, 37, 40, 41, 42, 43, 44, 48, 51, 54, 56, 57, 59, 60, 63, 64, 65, 66, 67 .......
```

## 套用修補程式

若要套用個別修補程式，請根據您的部署方法使用下列連結：

* Adobe Commerce或Magento Open Source內部部署： [[!DNL Quality Patches Tool] 指南中的](/help/tools/quality-patches-tool/usage.md)>使用狀況[!DNL Quality Patches Tool]。
* 雲端基礎結構上的Adobe Commerce：雲端基礎結構上的Commerce指南中的[升級和修補程式>套用修補程式](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html)。

## 相關閱讀

若要進一步瞭解[!DNL Quality Patches Tool]，請參閱：

* [[!DNL Quality Patches Tool]：「工具」指南中，品質修補程式](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md)的自助服務工具。
