---
title: 自行托管Adobe Commerce災難恢復
description: 了解要考慮的自行托管災難恢復思想和概念以及最佳做法。
landing-page-description: 了解自行托管Adobe Commerce時應考慮的一些災難恢復概念和事項。
short-description: 了解自行托管Adobe Commerce的策略和災難恢復概念。
kt: 11420
doc-type: tutorial
audience: all
last-substantial-update: 2023-04-13T00:00:00Z
source-git-commit: 6e361169889c8fe1c176d3a3283d52699dfa3b85
workflow-type: tm+mt
source-wordcount: '1771'
ht-degree: 0%

---


# 自行托管Adobe Commerce災難恢復理念

本文章的災難恢復包含失敗的部署。 雖然整個過程可能不相同，但也適用類似的原則。 災難可能是由於生產部署失敗、伺服器變得不響應、發現漏洞和許多其他情況所致。 如果故障部署的恢復過程可能只需要兩個簡單步驟，則從漏洞中恢復可能會更具挑戰性。 由於環境的複雜性、托管變異和其他複雜性，本文提供概念和概念，但您必須自行繼續調查。 這樣，您就可以確保設計出符合業務需要的策略。

## 實踐恢復過程通常

練習，練習，練習。 常式首先出現在災難恢復清單中的原因是有的。 要制定恢復計畫，但絕不執行，要容易得多。 如果實踐不夠，就容易出現錯誤、錯過步驟，並可能使實際恢復花費更長時間。 您和您的業務合作夥伴將決定您實踐恢復的速度。 讓恢復過程成為年度活動可能足夠好，但與貴公司的決策者進行深入對話應包括幾個關鍵主題。 這些主題有助於他們了解為什麼練習很重要而且應該受到期待。 以下幾個主題有助於開始對話：

* 實際發生事件時，實務可減少實際停機時間。 如果實務干預運行每年使您的站點運行1小時，則實際事件的實際停機時間可能會減少數小時。 恢復站點需要8小時或更長時間，這種情況並不罕見。 通過實踐此活動，您可以減少每個階段所花費的時間，並能夠更快地恢復。
* 這些操作運行的計畫停機時間可以與伺服器補丁程式、庫存調整或應定期執行的其他任何操作保持一致。
* 實作不同的情境，而非同一個情境。 從前一個日期開始，偶爾花點時間進行完全恢復。 這包括尋找和使用資料庫的封存副本、回滾程式碼以符合日期等。 更簡單的方法可能是從失敗部署中恢復，在該部署中，您只需要回滾到上一次提交。
* 驗證恢復過程是否確實有效，有時已存檔的資料庫可能會損壞。 通過這樣做，它可確保所有內容都能恢復，並且能夠正常工作。 查找和恢復舊資料庫需要時間，應該知道此過程的部分可能需要多久。
* 驗證配置中的所有更改都記錄在案。 這可確保任何從舊資料庫進行的恢復都能獲得任何新的配置更改，這些更改必須能夠正常工作。 例如，如果您的API金鑰在過去幾天變更為付款處理者。 通過擁有良好的更改管理流程，找到這些關鍵更新使流程按計畫運行。

## 資料庫備份

資料庫備份應相當常規。 每小時、每日、每週和每月快照的情況並不少見。 備份最終應移至長期儲存。 只要業務或技術團隊決定花費足夠的時間，以免不再需要從他們那裡快速恢復，就可以實現這一長期儲存。 從長期儲存進行恢復會為恢復過程增加時間，因此在決定何時應該發生時應謹慎考慮。 資料庫備份應自動執行，而不應依賴於人為交互。 這可確保您有足夠的這些服務提供安全、可預測的恢復過程。 這也有助於任何法證活動，如有必要，這種活動是可行和可靠的。 在檢測到漏洞後，或者嘗試診斷信用卡欺詐活動何時發生，甚至某人加入您的網站時，您可能會發現需要進行法證研究。 使用這些備份的方式沒有限制，但擁有良好的備份順序是您在實際需要時的保存優勢。

以下是資料保留原則的範例：

* 每八小時。 備份應該易於訪問。
* 過去七天的每日備份，應該可以隨時訪問。 這些檔案的副本可能是異地移動的候選檔案。
* 過去四周的每週備份都考慮異地備份。
* 過去3個月的每月備份已移至異地。
* 較舊的備份將移到異地的長期儲存。

## 作為代碼的基礎結構

此方法意味著您擁有可為項目重建部件或整個基礎架構的工具和代碼。 當伺服器遇到問題，且必須停止使用時，可能需要用到這項功能。 能夠快速將新伺服器聯機、部署代碼、進行任何PHP、Nginx或Apache配置等，自動意味著更少的停機時間。 即使是運行手冊中記錄好的步驟也易於設定，執行這些步驟的時間也要長得多。 另外，請考慮壓力下可能發生的人為錯誤，以使無響應的站點重新上線。

## 輔助資料庫

使用次資料庫可能很有用，原因有幾：

* 如果主驅動器出現故障，則熱備
* 允許來自應用程式的就緒請求
* 允許發生mysqldump並允許正常事務發生，而不鎖定資料庫
* 允許從外部資料源訪問資料，而不降低網站處理客戶請求資訊的能力。

次資料庫可用作 `warm standby`. 當您考慮如何從主資料庫故障中恢復時，這可能會發揮作用。 將輔助資料庫提升到主資料庫的複雜性比重建資料庫並將資料庫恢復到新建的Mysql實例的複雜性要低。 這減少了恢復操作期間的實際停機時間。

有機會將某些請求轉向輔助資料庫。 如果使用此方法，建議將次資料庫設為只讀。 允許Adobe Commerce應用程式使用此輔助資料庫執行讀取操作，有助於獲取一些讀取請求，並允許輔助資料庫響應。 不過，這項變更只佔所有請求的30-50%，但您從主要資料庫中提取的任何負載都是一次勝利。

## 建立包含回滾的部署計畫

每個部署都應包含回滾計畫。 是的，每個部署。 如果你為此做了計畫，你就永遠不會感到驚訝，而且已經準備好迎接糟糕的事件。 有時，最簡單的程式碼更新會因為任何原因而災難性地失敗。

請思考一下這個團隊的真實故事，他們提交了一個小型、簡單的提取請求，以執行資料庫中的架構更改。 隨著部署從1分鐘到5分鐘，然後10分鐘，團隊變得更擔心了。 到目前為止，他們未能驗證和考慮的是生產資料庫與測試資料庫之間的任何差異。 他們通常會在使用生產副本重新整理測試環境時移除所有客戶資料。 這表示在此之前，其所有測試和QA都反映部署需要幾分鐘的時間才能完成。 實際上，他們擁有2000多萬客戶，而這種小的模式改變需要非常長的時間才能完成。 因為他們不知道實際需要多長時間，他們被迫終止mysql過程並回滾部署。

為部署準備回滾過程只需幾分鐘，因為整個過程將相似。 不過，您應花時間將Git存放庫的HEAD重設回，以確切記錄要提交的內容。 如果當前快照始終位於同一位置，則應準確記錄要使用的資料庫快照或查找當前快照的位置。 已定義必須討論部署狀態的時間以及事項自動生效的時間。 例如，如果任何部署需要超過15分鐘，請詢問項目經理和其他權益持有者是否應繼續。 但是，如果流程需要45分鐘，則自動執行回滾流程並通知所有利益相關方（無論項目經理和架構師是否猶豫）。

確保有數人參與整個流程和每個階段。 讓中級開發人員審核部署過程、回滾過程和檔案的位置是讓他們參與的絕佳方式。 他們最終將執行這些步驟，因此讓他們了解整個過程是長期成功的關鍵。 請確保每個人都有權取消部署。 給予你的團隊這樣多的發言權是賦權和回報。 如果初級開發商真的覺得有些東西不見了，他們應該感到有必要站出來，聽聽他們的警告。 讓建築師和項目經理確認或減輕他們的恐懼。 有一支強大的團隊負責尋找專案，並保有無懈可擊的部署記錄，這一點非常重要。

## 驗證對域名管理、DMS、SSL、WAF的訪問

由於網域名稱會過期，因此DNS記錄可能會意外修改，SSL憑證可能會過期，等等；確保您能夠登錄並驗證連接應經常發生。 每季度進行一次簡單的檢查，您就能確信自己知道產品的確切位置，特別是在緊急情況下。 請勿假設您的DNS是由您的註冊機構管理，只為了了解您已在Amazon中管理DNS。 這些記錄不常被使用，因此，遺忘記錄的位置是很有可能的。 請勿僅信任用戶名和密碼的書面文檔。 登入每個設定，並確認您要尋找的設定實際上受到管理。 在管理層更替或公司收購期間，事情往往會發生變化，只有一個人知道發生了什麼，因為他們是更新的負責人。 他們不知道您依賴共用的Word文檔，該文檔的位置、用戶名和密碼。 尋找對您和您的組織而言有意義的檢查程式，但每三到六個月執行一次檢查是一個很好的起點。

{{$include /help/_includes/hosting-related-links.md}}
