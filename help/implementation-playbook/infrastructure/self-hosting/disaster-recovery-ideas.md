---
title: 自行託管Adobe Commerce災難回覆
description: 瞭解自行託管災難回覆的想法，以及可考慮的概念和最佳實務。
landing-page-description: 瞭解自行託管Adobe Commerce時的一些災難恢復概念和注意事項。
short-description: 瞭解自行託管Adobe Commerce的策略和災難回覆概念。
kt: 11420
doc-type: tutorial
audience: all
last-substantial-update: 2023-04-13T00:00:00Z
exl-id: cab6213b-da44-498f-b5c1-e7f89e95038e
source-git-commit: 95ffff39d82cc9027fa633dffedf15193040802d
workflow-type: tm+mt
source-wordcount: '1771'
ht-degree: 0%

---

# 自行託管Adobe Commerce災難回覆構想

本文章的災難回覆包含失敗的部署。 雖然整個程式可能不同，但適用類似的原則。 災難可能是由於生產部署失敗、伺服器無回應、發現利用漏洞和其他許多情況所造成。 如果失敗部署的復原程式可能只需要兩個簡單的步驟，從利用漏洞進行復原可能更具挑戰性。 由於環境的複雜性、託管變數和其他複雜性，本文會提供概念和概念，但您需要自行繼續調查。 如此一來，您就可以確保設計符合業務需求的策略。

## 經常練習復原程式

練習，練習，練習。 實務會先出現在災難回覆清單中是有原因的。 要設定復原計畫卻永遠無法執行，這相當容易。 如果您練習得不夠充分，就很容易發生錯誤、遺漏步驟，而且可能會使實際的復原需要更長的時間。 您和您的業務夥伴可以決定復原練習的步調。 讓復原程式變成一年一度的活動或許已經夠好了，但與公司決策者的深入對話應該包括幾個關鍵主題。 這些主題可協助他們瞭解為什麼練習很重要，而且應該受到期待。 以下主題可協助您展開對話：

* 練習可減少實際發生事件時的實際停機時間。 如果練習練習每年中斷您的網站一小時，可能會將實際事件的實際停機時間減少數小時。 通常需要八小時或更長的時間才能復原網站。 經常練習這項活動可以減少每個階段所需的時間，而且復原速度也會更快。
* 這些練習執行的排程停機時間，可以與伺服器修補程式、庫存調整或應定期執行的任何其他動作一致。
* 練習不同的情境，而不是相同的情境。 請偶爾花點時間，從先前的日期進行完整復原。 這包括尋找和使用資料庫的封存復本、復原程式碼以符合日期等內容。 較簡單的方法可能是從失敗的部署中復原，其中您只需復原到先前的認可。
* 驗證復原程式是否確實有效，有時封存的資料庫可能會損毀。 如此一來，可確保一切皆可復原且正常運作。 尋找和還原舊的DB需要時間，應該知道這個程式部分可能持續了多長時間。
* 驗證是否已記錄組態中的所有變更。 這可確保從舊資料庫進行任何復原時，只要有新的組態變更，就必須正常運作。 例如，如果您的API金鑰在過去幾天內變更為付款處理者。 透過良好的變更管理流程，找出這些重要更新即可讓流程如期進行。

## 資料庫備份

資料庫備份應相當定期。 每小時、每日、每週和每月都有快照，這並不罕見。 備份最終應移至長期儲存空間。 只要企業或技術團隊認為時間已過，可能不再需要快速回覆，就可以進行長期儲存。 從長期儲存體復原會增加復原程式所需的時間，所以在決定何時進行復原時請務必謹慎。 資料庫備份應自動化，而不需依賴人為互動。 這可確保您有足夠的資料來源，以提供安全且可預測的復原程式。 這也有助於任何法證活動（如果此類活動必要）的可行性和可靠性。 在偵測到利用漏洞後，或嘗試診斷信用卡詐騙活動何時發生，或甚至有人加入您的網站時，您可能會發現需要法證研究。 這些備份的使用方式並無限制，但擁有良好的備份節奏是您在實際需要時可省下的地方。

以下是資料保留原則的範例：

* 每8小時。 備份應易於存取。
* 過去七天的每日備份，應易於存取。 這些檔案的復本可能是移離現場的候選檔案。
* 過去四週每週的備份都會考慮移離現場。
* 過去三個月的每月備份已移離現場。
* 較舊的備份會移至異地長期儲存。

## 以程式碼表示的基礎結構

此方法表示您已有合適的工具和程式碼來重建專案的零件或整個基礎結構。 伺服器發生問題時可能需要此專案，且必須停止使用。 能夠快速將新伺服器上線、部署程式碼、進行任何PHP、Nginx或Apache設定，以及其他任何設定，自動錶示停機時間更短。 即使是執行手冊中經過妥善記錄的步驟，也更容易設定，執行這些步驟所需的時間會更長。 此外，請考量在壓力下使無回應網站重新上線時可能發生的人為錯誤。

## 次要資料庫

使用次要資料庫可能很實用，原因如下：

* 如果主要磁碟機發生故障，則為暖待命
* 允許來自應用程式的就緒請求
* 允許發生mysqldump，並允許在不鎖定資料庫的情況下發生正常交易
* 允許從外部資料來源存取資料，而不會降低網站根據客戶請求交易資訊的能力。

次要資料庫可以用作 `warm standby`. 當您考慮如何從主要資料庫失敗中復原時，這可能會生效。 將次要資料庫升級為主要資料庫，比將資料庫重建和還原為新建立的Mysql執行個體要簡單。 這減少了復原作業期間的實際停機時間。

有機會將部分請求轉移到次要資料庫。 若使用此方法，建議將次要資料庫設為唯讀。 允許Adobe Commerce應用程式使用此次要資料庫進行讀取作業，有助於接受一些讀取請求並允許次要資料庫回應。 不過，這項變更只佔所有請求的30-50%，但您可以從主要資料庫中移除的任何負載都是一種勝利。

## 建立包含復原的部署計畫

每個部署都應包含復原計畫。 是的，每次部署。 如果您對此有所規劃，您絕不會對此感到驚訝，並準備好應對不良事件。 有時候，最簡單的程式碼更新可能會因任何原因而災難性失敗。

假設一個團隊認可小型簡單提取請求，以在資料庫中執行結構描述變更的真實案例。 隨著部署從1分鐘增加到5分鐘，接著又增加到10分鐘，團隊變得更加擔心。 他們至今未能驗證並考慮的是，生產資料庫和中繼資料庫之間有任何差異。 他們有一個通用做法，在使用生產復本重新整理中繼環境時移除所有客戶資料。 這表示在此之前的所有測試和QA都會反映部署，應該只需要幾分鐘即可完成。 事實上，他們擁有超過2,000萬客戶，而這項細微的結構變更需要極長時間才能完成。 由於他們不知道這實際需要多久，因此他們被迫終止mysql程式並復原部署。

準備部署的復原程式只需要幾分鐘的時間，因為整個程式會很類似。 不過，您應花一些時間記錄您會將Git存放庫的HEAD重設回哪個認可。 您應該記錄要使用哪些db快照，或尋找目前快照的位置（如果總是位於相同位置）。 已定義必須討論部署狀態的時間以及自動生效的時間。 例如，如果任何部署需要超過15分鐘，請詢問專案經理和其他利害關係人是否應該繼續。 但是，如果回滾流程需要45分鐘，則自動執行並通知所有利害關係人，無論專案經理和架構師是否對專案有所猶豫。

請確定有幾個人參與了整個流程和每個階段。 讓中層開發人員檢閱部署程式、復原程式和檔案位置，是讓他們參與的絕佳方式。 他們最終會執行這些步驟，因此讓他們瞭解整個流程是長期成功的關鍵。 確保每個人都有權叫用部署。 讓您的團隊擁有如此多的發言權，可帶來動力和回報。 如果資歷較淺的開發人員真的覺得缺少某樣東西，他們應該感到必須大聲疾呼，讓別人聽到他們的警告。 讓架構師和專案經理確認或減輕他們的恐懼。 請務必建立一支強大的團隊，負責尋找專案，並保持完美部署的往績記錄。

## 驗證網域名稱管理、DMS、SSL、WAF的存取權

由於網域名稱過期，DNS記錄可能會意外修改、SSL憑證可能會過期等等；請確定您有能力登入並驗證是否經常連線。 每季進行這項簡單的檢查，可讓您確信自己知道東西的確切位置，尤其是在緊急情況下。 請勿假設您的DNS是在您的註冊機構中進行管理，只是為了知道您已在Amazon中進行管理。 這些記錄並不常使用，因此很容易會忘記其所在位置。 不要只信任使用者名稱和密碼的書面檔案。 登入每一項，並確認您所尋找的設定實際上是由該處管理。 在管理層的更替或公司收購期間，事情經常會改變，而且只有一個人知道發生了什麼，因為他們是進行更新的人。 他們不知道您依賴共用的Word檔案所在的位置、使用者名稱和密碼。 找出對您及您的組織有意義的檢查程式，但每三至六個月執行此作業是很好的起點。

{{$include /help/_includes/hosting-related-links.md}}
