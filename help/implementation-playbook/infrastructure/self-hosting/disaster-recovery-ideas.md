---
title: 自主承載Adobe Commerce災難恢復
description: 瞭解要考慮的自我托管災難恢復理念和概念以及最佳做法。
landing-page-description: 瞭解一些災難恢復概念和需要考慮的事項，以便您自己主持Adobe Commerce。
short-description: 瞭解自己托管Adobe Commerce的戰略和災難恢復概念。
kt: 11420
doc-type: tutorial
audience: all
last-substantial-update: 2023-04-13T00:00:00Z
exl-id: cab6213b-da44-498f-b5c1-e7f89e95038e
source-git-commit: 95ffff39d82cc9027fa633dffedf15193040802d
workflow-type: tm+mt
source-wordcount: '1771'
ht-degree: 0%

---

# 自主承載Adobe Commerce災難恢復理念

此文章的災難恢復包括失敗的部署。 儘管整個過程可能不相同，但同樣的原則也適用。 災難可能是由於生產部署失敗、伺服器變得無響應、發現利用漏洞和許多其他情形。 如果失敗部署的恢復過程可能只需要兩個簡單步驟，則從利用漏洞進行恢復可能更具挑戰性。 由於環境的複雜性、托管變化和其他複雜性，本文提供了思想和概念，但您需要自己繼續調查。 這樣，您就可以確保設計出符合業務需要的策略。

## 通常做法恢復過程

實踐，實踐，實踐。 在災難恢復清單中首先出現實踐是有原因的。 要建立一個恢復計畫，但永遠不執行它，是很難的。 如果練得不夠，容易出錯、錯過步驟，而且可能會使實際恢復花費更長時間。 恢復實踐的節奏取決於您和您的業務合作夥伴。 將恢復過程作為年度活動可能已經足夠好了，但與公司中的那些決策者進行深入交談時，應包括幾個關鍵主題。 這些主題有助於他們理解為什麼練習很重要，並且應該受到期待。 以下是一些有助於開始對話的主題：

* 練習可減少實際發生事件時的實際停機時間。 如果練習「乾」運行每年將您的站點停機1小時，則實際事件的實際停機時間可能會減少數小時。 恢復站點需要8小時或更長時間的情況並不少見。 通過練習此活動，您可以減少每個階段所花的時間，並且能夠更快地恢復。
* 這些實踐運行的計畫停機時間可能與伺服器補丁程式、庫存調整或應按常規計畫執行的任何其他操作一致。
* 練習不同的場景，而不是同一種場景。 偶爾花點時間，從上一日期開始進行完全恢復。 這包括查找和使用資料庫的存檔副本、回滾代碼以匹配日期等內容。 一個更簡單的方法是從失敗的部署中恢復，在此過程中您只需回滾到上一次提交。
* 驗證恢復過程是否確實有效，有時存檔的資料庫可能會損壞。 通過這樣做，它可確保所有內容都能夠恢復並正常工作。 查找和恢復舊資料庫需要時間，應該知道該過程的這一部分可能需要多長時間。
* 驗證配置中的所有更改是否都有文檔記錄。 這可確保從舊資料庫恢復的任何新配置更改都必須能夠正常工作。 例如，如果API密鑰在過去幾天內更改為付款處理器。 通過擁有良好的變更管理流程，找到這些關鍵更新使流程按計畫進行。

## 資料庫備份

資料庫備份應相當常規。 每小時、每天、每週和每月都有快照，這種情況並不罕見。 備份最終應移動到長期儲存。 只要業務或技術團隊認為已經過了足夠的時間，可能不再需要從他們那裡快速恢復，就可以進行這種長期儲存。 從長期儲存進行恢復會為恢復過程增加時間，因此在確定何時應該發生此情況時應謹慎。 資料庫備份應自動化，而不應依賴人工交互。 這可確保您有足夠的恢復流程來提供安全且可預知的恢復過程。 這也有助於開展任何法證活動，如有必要，是可行和可靠的。 在檢測到利用漏洞後，或當嘗試診斷何時發生信用卡欺詐活動，甚至當某人加入您的網站時，您可能會發現需要進行法醫研究。 使用這些備份的方式沒有限制，但擁有良好的備份順序是您真正需要時的節約優勢。

以下是資料保留策略的示例：

* 每八小時。 備份應易於訪問。
* 過去七天的每日備份，應該易於訪問。 他們的拷貝可能是被移到異地的候選。
* 過去四周的每週備份考慮移到異地。
* 過去三個月的每月備份都移到異地。
* 舊備份將移到異地的長期儲存。

## 作為代碼的基礎架構

此方法意味著您擁有適當的工具和代碼來為項目重建部件或整個基礎架構。 當伺服器遇到問題且必須停止使用時，可能需要這樣做。 能夠快速將新伺服器聯機、部署代碼、進行任何PHP、Nginx或Apache配置，以及其他任何配置，自動意味著減少停機時間。 即使是運行手冊中記錄良好的步驟也更容易設定，執行這些步驟需要更長的時間。 另外，考慮在壓力下可能發生的人為錯誤，使無響應的站點恢復聯機。

## 輔助資料庫

使用輔助資料庫可能有用，原因有幾：

* 如果主驅動器出現故障，則熱備用
* 允許應用程式提供就緒請求
* 允許發生mysqldump，並允許正常事務發生而不鎖定資料庫
* 允許從外部資料源訪問資料，而不降低網站處理客戶請求資訊的能力。

次資料庫可用作 `warm standby`。 當您考慮如何從主資料庫故障中恢復時，可能會發揮這一作用。 將輔助資料庫升級為主資料庫的複雜性低於將資料庫重建和恢復到新建立的Mysql實例的複雜性。 這減少了恢復操作期間的實際停機時間。

有機會將一些請求轉移到輔助資料庫。 如果使用此方法，則建議將輔助資料庫設定為只讀。 允許Adobe Commerce應用程式使用此輔助資料庫進行讀取操作有助於獲取一些讀取請求並允許輔助資料庫進行響應。 但是，此更改僅佔所有請求的30-50%，但您可以從主資料庫中帶走的任何負載都是勝利。

## 建立包括回滾的部署計畫

每個部署都應包括回滾計畫。 是的，每個部署。 如果你為此做了計畫，你就永遠不會感到驚訝，並準備好迎接糟糕的事件。 有時，最簡單的代碼更新會因任何原因災難性地失敗。

請考慮這個團隊的真實故事，該團隊提交了一個小而簡單的拉式請求，以在資料庫中執行模式更改。 隨著部署從1分鐘到5分，再到10分，團隊變得更加擔心。 到目前為止，他們未能驗證和考慮的是與臨時資料庫相比生產資料庫的任何差異。 他們通常在使用生產副本刷新登台環境時刪除所有客戶資料。 這意味著在完成部署之前，他們的所有測試和QA都應該只需幾分鐘即可完成。 事實上，他們有2000多萬客戶，而這個小小的模式改變需要非常長的時間才能完成。 因為他們不知道這實際需要多長時間，他們被迫終止mysql過程並回退部署。

為部署準備回滾過程只需幾分鐘，因為整個過程將會類似。 但是，您應該花些時間來準確記錄將Git儲存庫的HEAD重置回的提交內容。 如果當前快照始終位於同一位置，則應準確記錄要使用的資料庫快照或查找當前快照的位置。 定義必須討論部署狀態的時間和自動生效的時間。 例如，如果任何部署需要超過15分鐘，請詢問項目經理和其他利益相關者是否應該繼續部署。 但是，如果流程耗時45分鐘，則自動執行回滾流程並通知所有利益相關方，而不管項目經理和項目設計師是否猶豫。

確保有幾個人參與整個過程和每個階段。 讓中級開發人員審查檔案的部署過程、回滾過程和位置是讓他們參與其中的絕佳方法。 他們最終將採取這些步驟，讓他們瞭解整個過程是取得長期成功的關鍵。 確保每個人都有權取消部署。 給予你的團隊如此多的發言權是賦權和回報。 如果初級開發商真的覺得少了些東西，就應該被迫大聲說出來，聽聽他們的謹慎。 讓建築師和項目經理確認或減輕他們的恐懼。 有一支強大的團隊來關注項目並保持其完美部署的記錄，這一點非常重要。

## 驗證對域名管理、DMS、SSL、WAF的訪問

由於域名過期，DNS記錄可能會被意外修改，SSL證書可能會過期，等等；確保您能夠登錄並驗證連接是否應經常發生。 每季度進行一次簡單的檢查，讓您確信自己確切知道事情的所在地，特別是在緊急情況下。 不要假設您的DNS在註冊機中受管，只為了瞭解您已在Amazon管理過DNS。 這些記錄不常被使用，因此忘記它們的位置是很有可能的。 不要僅信任用戶名和密碼的書面文檔。 登錄到每個配置，並驗證您要查找的配置是否在那裡實際管理。 在管理層更替或公司收購期間，情況往往會發生變化，只有一個人知道發生了什麼，因為他們是更新的完成者。 他們不知道您依賴的是共用Word文檔的位置、用戶名和密碼。 尋找一個對您和您的組織來說有意義的檢查流程，但每三至六個月執行一次該操作是一個不錯的起點。

{{$include /help/_includes/hosting-related-links.md}}
