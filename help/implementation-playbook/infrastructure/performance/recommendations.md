---
title: 效能最佳化Recommendations
description: 遵循這些建議，最佳化Adobe Commerce實作的效能。
exl-id: c5d62e23-be43-4eea-afdb-bb1b156848f9
source-git-commit: bbc412f1ceafaa557d223aabfd4b2a381d6ab04a
workflow-type: tm+mt
source-wordcount: '1289'
ht-degree: 0%

---

# 效能最佳化審核

雖然效能最佳化可能來自許多方面，但在大多數情況下，仍應考慮一些一般建議。 這包括基礎架構元素的配置優化、Adobe Commerce後端配置和體系結構可擴充性規劃。

## 基礎設施

以下各節將說明基礎架構最佳化的建議。

### DNS查閱

DNS查閱是尋找網域名稱所屬IP位址的程式。 瀏覽器必須等到DNS查閱完成，才能下載每個要求的任何內容。 減少DNS查閱對於改善整體頁面載入時間非常重要。

### 內容傳遞網路(CDN)

使用CDN來最佳化資產下載效能。 Adobe Commerce使用Amply。 如果您是Adobe Commerce的內部實作，您也應考慮新增CDN層。

### 網頁延遲

資料中心的位置會影響前端用戶的Web延遲。

### 網路頻寬

足夠的網路頻寬是Web節點、資料庫、快取/會話伺服器和其他服務之間資料交換的關鍵要求之一。

由於Adobe Commerce有效運用快取來提升效能，因此您的系統可主動與Redis等快取伺服器交換資料。 如果Redis位於遠程伺服器上，則必須在Web節點和快取伺服器之間提供足夠的網路通道，以防止讀/寫操作出現瓶頸。

### 作業系統(OS)

與其他高負載Web應用程式相比，Adobe Commerce的作業系統配置和最佳化類似。 隨著伺服器處理的併發連接數的增加，可用套接字的數量可以被完全分配。

### Web節點的CPU

一個CPU核心可處理約2至4個Adobe Commerce請求，無須快取。 要確定處理所有傳入請求而不將其放入隊列所需的Web節點/核心數，請使用以下公式：

```
N[Cores] = (N [Expected Requests] / 2) + N [Expected Cron Processes])
```

### PHP-FPM設定

最佳化這些設定取決於不同專案的效能測試結果。

- **位元組代碼** — 若要在PHP 7上讓Adobe Commerce發揮最大速度，您必須啟用 `opcache` 模組並正確設定。

- **APCU** — 我們建議啟用PHP APCu擴展並配置Composer以優化以獲得最大效能。 此擴充功能會快取已開啟檔案的檔案位置，以提高Adobe Commerce伺服器呼叫（包括頁面、Ajax呼叫和端點）的效能。

- **Realpath_cacheconfiguration** — 優化 `realpath_cache` 允許PHP進程快取到檔案的路徑，而不是每次頁面載入時查找路徑。

### Web伺服器

將nginx用作Web伺服器只需輕微重新配置。 nginx Web伺服器提供更佳的效能，且使用Adobe Commerce的範例設定檔案即可輕鬆進行設定([`nginx.conf.sample`](https://github.com/magento/magento2/blob/2.4/nginx.conf.sample))。

- 正確設定PHP-FPM和TCP

- 啟用HTTP/2和Gzip

- 優化工作人員連接

### 資料庫

本文檔不提供深入的MySQL優化指令，因為每個儲存和環境都不同，但我們可以提供一些一般建議。

Adobe Commerce資料庫（以及任何其他資料庫）對於可用於儲存資料和索引的記憶體量非常敏感。 為了有效利用MySQL資料索引，可用記憶體量至少應接近資料庫中儲存資料的一半大小。

最佳化 `innodb_buffer_pool_instances` 設定，以避免多個執行緒嘗試存取相同例項時發生問題。 的值 `max_connections` 參數應與應用程式伺服器中配置的PHP線程總數相關。 使用下列公式計算 `innodb-thread-concurrency`:

```
innodb-thread-concurrency = 2 * (NumCPUs+NumDisks)
```

### 工作階段快取

工作階段快取是為個別Redis例項進行設定的理想候選項。 此快取類型的記憶體配置應考慮網站的購物車放棄策略，以及工作階段預計會保留在快取中的時間。

Redis應分配足夠的記憶體來將所有其他快取保存在記憶體中，以獲得最佳效能。 塊快取將是決定要配置的記憶體量的關鍵因素。 區塊快取會隨著網站上的頁面數量（SKU數目x商店檢視次數）而增加。

### 頁面快取

強烈建議在您的Adobe Commerce存放區上，將清漆用於整頁快取。 此 `PageCache` 模組仍存在於程式碼基底中，但應僅用於開發用途。

將清漆安裝在Web層前面的單獨伺服器上。 它應接受所有傳入的請求，並提供快取的頁面副本。 為了使Riest能夠有效地與安全頁一起工作，SSL終止代理可以放置在Riest之前。 Nginx可用於此用途。

雖然清漆全頁快取記憶體無效有效，但建議為清漆分配足夠的記憶體，以將您最受歡迎的頁面保留在記憶體中。

### 消息隊列

消息隊列框架(MQF)是一個允許模組將消息發佈到隊列的系統。 它也會定義非同步接收訊息的使用者。 Adobe Commerce支援RabbitMQ作為報文代理，該代理為發送和接收報文提供了可擴展平台。

### 效能測試和監控

每次生產發行前的效能測試一律建議您取得電子商務平台功能的預估。 在啟動後保持監控，並有可擴充性和備份計畫來處理高峰時間。

>[!NOTE]
>
> 雲端基礎架構上的Adobe Commerce已套用上述所有基礎架構和架構最佳化，但DNS查閱除外，因為它超出範圍。

### 搜尋

自Adobe Commerce 2.4版起即需使用Elasticsearch，但若要啟用2.4之前的版本，也需使用最佳實務。

## 作業模式

除了以前提到的常見基礎架構優化建議外，還有一些方法可增強特定業務模式和擴展的效能。 本文檔不提供所有這些方案的深入調整說明，因為每個方案都不同，但我們可以提供一些高級選項供您參考。

### 無頭式架構

我們有一個單獨的部分，專門用於詳細描述 [無頭](../../architecture/headless/adobe-commerce.md) 是和不同的選項。 總之，它將店面層與平台本身分離。 雖然仍是相同的後端，但Adobe Commerce不再直接處理請求，而是僅支援透過GraphQL API的自訂店面。

### 更新Adobe Commerce

Adobe Commerce執行最新版本時一律效能較佳。 即使每個新版本發行後都無法讓Adobe Commerce保持最新，仍建議您 [升級](../../../upgrade/overview.md) 當Adobe Commerce推出重大效能最佳化時。

例如，2020年，Adobe發佈了Redis層的最佳化，解決了Redis和Adobe Commerce之間許多低效、連線問題和不必要的資料傳輸問題。 2.3和2.4之間的整體效能是夜以繼日的，我們在購物車、結帳和同時使用者方面都有顯著改善，這只是因為Redis最佳化的緣故。

### 最佳化資料模型

許多問題都源自於資料，包括錯誤的資料模型、未正確結構化的資料以及缺少索引的資料。

如果您正在測試幾個連線，看起來不錯，但實際流量點擊時，生產環境中就會出現這個情況，而速度就會變慢。 系統整合商必須知道如何設計資料模型（尤其是針對產品屬性）、避免新增不必要的屬性，以及保留影響業務邏輯的必要屬性（例如定價、股票可用性和搜尋），這一點非常重要。

對於那些不影響業務邏輯但仍需顯示在店面的屬性，請將它們合併為幾個屬性（例如JSON格式）。

為了優化平台效能，如果從PIM或ERP獲取的資料或屬性中不需要店面上的業務邏輯，則無需將該屬性添加到Adobe Commerce中。

### 設計可擴充性

這對於經常進行宣傳並面臨高峰期的企業來說很重要。 對於架構和應用程式設計來說，要便於擴展，這樣可以在高峰時間增加資源，並在之後減少資源。
